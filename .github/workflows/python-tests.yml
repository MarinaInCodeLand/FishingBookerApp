- uses: actions/checkout@v2

- name: Install Google Chrome
  run: |
    sudo apt-get update
    sudo apt-get install -y wget unzip
    wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
    sudo apt install -y ./google-chrome-stable_current_amd64.deb

- name: Get Chrome version
  id: chrome-version
  run: |
    CHROME_VERSION=$(google-chrome --version | grep -oP '\d+\.\d+\.\d+')
    echo "CHROME_VERSION=$CHROME_VERSION" >> $GITHUB_ENV

- name: Install matching ChromeDriver
  run: |
    CHROMEDRIVER_VERSION=$(curl -sS chromedriver.storage.googleapis.com/LATEST_RELEASE_${CHROME_VERSION%.*})
    wget -N https://chromedriver.storage.googleapis.com/$CHROMEDRIVER_VERSION/chromedriver_linux64.zip
    unzip -o chromedriver_linux64.zip
    sudo mv -f chromedriver /usr/local/bin/chromedriver
    sudo chmod +x /usr/local/bin/chromedriver

- name: Set up Python
  uses: actions/setup-python@v2
  with:
    python-version: '3.10'

- name: Install dependencies
  run: |
    python -m pip install --upgrade pip
    pip install -r requirements.txt
    pip install pytest pytest-html selenium

- name: Run tests
  run: |
    pytest test_cases --html=report.html
